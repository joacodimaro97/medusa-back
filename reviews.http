### Variables de entorno
@baseUrl = http://localhost:3001
@adminToken = {{adminLogin.response.body.token}}
@userToken = {{userLogin.response.body.token}}

### ========================================
### AUTENTICACIÓN
### ========================================

### Login como admin
# @name adminLogin
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "admin@medusa.com",
  "password": "admin123"
}

### Login como usuario
# @name userLogin
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "juan@example.com",
  "password": "123456"
}

### ========================================
### CRUD BÁSICO DE RESEÑAS
### ========================================

### Crear reseña (usuario autenticado)
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "productId": "{{$randomUUID}}",
  "rating": 5,
  "comment": "Excelente producto, muy buena calidad y envío rápido. Lo recomiendo totalmente."
}

### Crear reseña con rating 4
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "productId": "{{$randomUUID}}",
  "rating": 4,
  "comment": "Buen producto, cumple con las expectativas. El envío fue un poco lento pero llegó en perfecto estado."
}

### Crear reseña con rating 3
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "productId": "{{$randomUUID}}",
  "rating": 3,
  "comment": "Producto regular, calidad aceptable pero podría mejorar en algunos aspectos."
}

### Obtener todas las reseñas
GET {{baseUrl}}/reviews

### Obtener reseñas con filtros
GET {{baseUrl}}/reviews?productId={{$randomUUID}}&rating=5&page=1&limit=5

### Obtener reseña específica
GET {{baseUrl}}/reviews/{{$randomUUID}}

### Obtener reseñas de un producto específico
GET {{baseUrl}}/reviews/product/{{$randomUUID}}

### Obtener reseñas de un producto con filtros
GET {{baseUrl}}/reviews/product/{{$randomUUID}}?rating=5&page=1&limit=3

### Actualizar reseña propia
PUT {{baseUrl}}/reviews/{{$randomUUID}}
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "rating": 4,
  "comment": "Actualizado: Mejoré mi opinión después de usar más el producto. Muy satisfecho."
}

### Eliminar reseña propia
DELETE {{baseUrl}}/reviews/{{$randomUUID}}
Authorization: Bearer {{userToken}}

### ========================================
### RATINGS Y ESTADÍSTICAS (Públicas)
### ========================================

### Obtener estadísticas de ratings por producto
GET {{baseUrl}}/reviews/ratings/product/{{$randomUUID}}

### Obtener productos mejor calificados
GET {{baseUrl}}/reviews/ratings/top-products?limit=10&minReviews=1

### Obtener productos mejor calificados con mínimo de reseñas
GET {{baseUrl}}/reviews/ratings/top-products?limit=5&minReviews=3

### Obtener reseñas con rating 5 estrellas
GET {{baseUrl}}/reviews/ratings/5

### Obtener reseñas con rating 4 estrellas
GET {{baseUrl}}/reviews/ratings/4

### Obtener reseñas con rating 3 estrellas
GET {{baseUrl}}/reviews/ratings/3

### Obtener reseñas con rating 2 estrellas
GET {{baseUrl}}/reviews/ratings/2

### Obtener reseñas con rating 1 estrella
GET {{baseUrl}}/reviews/ratings/1

### Obtener reseñas por rating de un producto específico
GET {{baseUrl}}/reviews/ratings/5?productId={{$randomUUID}}

### Obtener estadísticas generales de ratings
GET {{baseUrl}}/reviews/ratings/stats

### Obtener estadísticas de ratings por período
GET {{baseUrl}}/reviews/ratings/stats?startDate=2024-01-01&endDate=2024-12-31

### ========================================
### MODERACIÓN DE RESEÑAS (Admin)
### ========================================

### Obtener reseñas pendientes de moderación
GET {{baseUrl}}/reviews/moderation/pending
Authorization: Bearer {{adminToken}}

### Obtener reseñas pendientes con paginación
GET {{baseUrl}}/reviews/moderation/pending?page=1&limit=5
Authorization: Bearer {{adminToken}}

### Aprobar una reseña
PATCH {{baseUrl}}/reviews/moderation/{{$randomUUID}}/approve
Authorization: Bearer {{adminToken}}

### Rechazar una reseña
PATCH {{baseUrl}}/reviews/moderation/{{$randomUUID}}/reject
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "reason": "Comentario inapropiado o spam"
}

### Obtener reseñas aprobadas
GET {{baseUrl}}/reviews/moderation/approved
Authorization: Bearer {{adminToken}}

### Obtener reseñas rechazadas
GET {{baseUrl}}/reviews/moderation/rejected
Authorization: Bearer {{adminToken}}

### Obtener estadísticas de moderación
GET {{baseUrl}}/reviews/moderation/stats
Authorization: Bearer {{adminToken}}

### Obtener estadísticas de moderación por período
GET {{baseUrl}}/reviews/moderation/stats?startDate=2024-01-01&endDate=2024-12-31
Authorization: Bearer {{adminToken}}

### ========================================
### EJEMPLOS DE RESEÑAS COMPLETAS
### ========================================

### Ejemplo 1: Reseña muy positiva
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "productId": "{{$randomUUID}}",
  "rating": 5,
  "comment": "¡Increíble producto! Superó todas mis expectativas. La calidad es excepcional, el envío fue rápido y el servicio al cliente fue excelente. Definitivamente lo recomiendo y volveré a comprar."
}

### Ejemplo 2: Reseña positiva con sugerencias
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "productId": "{{$randomUUID}}",
  "rating": 4,
  "comment": "Muy buen producto en general. La calidad es buena y el precio es justo. Mi única sugerencia sería mejorar el empaquetado para que sea más resistente durante el envío."
}

### Ejemplo 3: Reseña neutral
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "productId": "{{$randomUUID}}",
  "rating": 3,
  "comment": "El producto cumple su función básica. No es extraordinario pero tampoco malo. El envío tardó más de lo esperado pero llegó en buen estado."
}

### Ejemplo 4: Reseña negativa constructiva
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "productId": "{{$randomUUID}}",
  "rating": 2,
  "comment": "No estoy satisfecho con la calidad del producto. Llegó con algunos defectos menores y el material no es tan resistente como esperaba. El servicio al cliente respondió pero la solución no fue satisfactoria."
}

### Ejemplo 5: Reseña muy negativa
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "productId": "{{$randomUUID}}",
  "rating": 1,
  "comment": "Muy decepcionado con este producto. Llegó dañado, la calidad es muy pobre y no cumple con lo prometido. El envío tardó mucho y el servicio al cliente fue inútil. No lo recomiendo."
}

### ========================================
### FLUJO COMPLETO DE MODERACIÓN
### ========================================

### 1. Crear reseña (se crea como pendiente)
# @name createReview
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "productId": "{{$randomUUID}}",
  "rating": 4,
  "comment": "Buen producto, funciona bien. Recomendado."
}

### 2. Ver reseñas pendientes (admin)
GET {{baseUrl}}/reviews/moderation/pending
Authorization: Bearer {{adminToken}}

### 3. Aprobar la reseña (admin)
PATCH {{baseUrl}}/reviews/moderation/{{createReview.response.body.data._id}}/approve
Authorization: Bearer {{adminToken}}

### 4. Ver estadísticas de ratings del producto
GET {{baseUrl}}/reviews/ratings/product/{{createReview.response.body.data.productId}}

### 5. Ver reseña aprobada
GET {{baseUrl}}/reviews/{{createReview.response.body.data._id}}

### ========================================
### PRUEBAS DE VALIDACIÓN
### ========================================

### Intentar crear reseña sin autenticación (debe fallar)
POST {{baseUrl}}/reviews
Content-Type: application/json

{
  "productId": "{{$randomUUID}}",
  "rating": 5,
  "comment": "Esta reseña no debería crearse"
}

### Intentar crear reseña con rating inválido (debe fallar)
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "productId": "{{$randomUUID}}",
  "rating": 6,
  "comment": "Rating inválido"
}

### Intentar crear reseña con comentario muy largo (debe fallar)
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "productId": "{{$randomUUID}}",
  "rating": 5,
  "comment": "Este comentario es extremadamente largo y debería exceder el límite de caracteres permitido por el sistema. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo."
}

### Intentar crear reseña duplicada (debe fallar)
POST {{baseUrl}}/reviews
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "productId": "{{$randomUUID}}",
  "rating": 5,
  "comment": "Segunda reseña para el mismo producto"
}

### Intentar actualizar reseña de otro usuario (debe fallar)
PUT {{baseUrl}}/reviews/{{$randomUUID}}
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "rating": 1,
  "comment": "Intentando modificar reseña de otro usuario"
} 